<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÙØ±Ù… Ø¢Ø²Ù…ÙˆÙ† - ØªØ´Ø®ÛŒØµ ØªÙ‚Ù„Ø¨</title>
  <style>
    body { font-family: Tahoma, sans-serif; padding: 2rem; background: #f5f5f5; }
    h1 { color: #333; }
    input, textarea { display: block; margin-bottom: 1rem; width: 100%; padding: 0.5rem; border-radius: 6px; border: 1px solid #ccc; }
    button { padding: 0.6rem 1.5rem; background: #2196f3; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #0b7dda; }
    #result { margin-top: 2rem; font-weight: bold; white-space: pre-wrap; direction: rtl; background: #fff; padding: 1rem; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>ğŸ“ ÙØ±Ù… Ù¾Ø§Ø³Ø®â€ŒØ¯Ù‡ÛŒ Ø¢Ø²Ù…ÙˆÙ†</h1>

  <input id="studentId" placeholder="Ø´Ù†Ø§Ø³Ù‡ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² (Ù…Ø«Ù„Ø§Ù‹ S1)" required>
  <textarea id="q1" placeholder="Ù¾Ø§Ø³Ø® Ù¾Ø±Ø³Ø´ Ø§ÙˆÙ„"></textarea>
  <input type="number" id="t1" placeholder="Ø²Ù…Ø§Ù† ØµØ±Ùâ€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø³Ø´ Ø§ÙˆÙ„ (Ø«Ø§Ù†ÛŒÙ‡)">
  <textarea id="q2" placeholder="Ù¾Ø§Ø³Ø® Ù¾Ø±Ø³Ø´ Ø¯ÙˆÙ…"></textarea>
  <input type="number" id="t2" placeholder="Ø²Ù…Ø§Ù† ØµØ±Ùâ€ŒØ´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø³Ø´ Ø¯ÙˆÙ… (Ø«Ø§Ù†ÛŒÙ‡)">

  <button onclick="submitAnswers()">Ø«Ø¨Øª Ù¾Ø§Ø³Ø®</button>
  <button onclick="analyze()">ØªØ­Ù„ÛŒÙ„ ØªÙ‚Ù„Ø¨</button>

  <div id="result"></div>

  <script>
    async function submitAnswers() {
      const studentId = document.getElementById('studentId').value.trim();
      const q1 = document.getElementById('q1').value.trim();
      const t1 = parseInt(document.getElementById('t1').value);
      const q2 = document.getElementById('q2').value.trim();
      const t2 = parseInt(document.getElementById('t2').value);

      const payload = {
        student_id: studentId,
        answers: [
          { question_id: "Q1", text: q1, time_taken: t1 },
          { question_id: "Q2", text: q2, time_taken: t2 }
        ]
      };

      console.log("ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ø¯Ø§Ø¯Ù‡:", payload);

      try {
        const res = await fetch('http://127.0.0.1:8000/submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error("Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø² Ø³Ø±ÙˆØ±");

        const data = await res.json();
        document.getElementById('result').innerText = 'âœ… ' + data.message;
      } catch (err) {
        document.getElementById('result').innerText = 'âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾Ø§Ø³Ø®';
        console.error("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„:", err);
      }
    }

    async function analyze() {
      console.log("ğŸ” Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„ ØªÙ‚Ù„Ø¨...");
      try {
        const res = await fetch('http://127.0.0.1:8000/analyze');
        if (!res.ok) throw new Error("Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø² Ø³Ø±ÙˆØ±");

        const data = await res.json();
        console.log("ğŸ“¥ Ù†ØªÛŒØ¬Ù‡ Ø§Ø² Ø³Ø±ÙˆØ±:", data);

        if (data.text_similarity_suspects.length === 0 && data.time_similarity_suspects.length === 0) {
          document.getElementById('result').innerText = 'âœ… Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„:\nÙ‡ÛŒÚ† Ù…ÙˆØ±Ø¯ Ù…Ø´Ú©ÙˆÚ©ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.';
          return;
        }

        let output = "Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„ ØªÙ‚Ù„Ø¨:\n\n";

        if (data.text_similarity_suspects.length > 0) {
          output += "ğŸ‘¯ ØªØ´Ø§Ø¨Ù‡ Ù…ØªÙ†ÛŒ:\n";
          data.text_similarity_suspects.forEach(item => {
            output += `Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ${item.student1} Ùˆ ${item.student2} Ø¯Ø± ${item.question_id} Ø¨Ø§ Ø´Ø¨Ø§Ù‡Øª ${item.similarity}%\n`;
          });
        }

        if (data.time_similarity_suspects.length > 0) {
          output += "\nâ±ï¸ ØªØ´Ø§Ø¨Ù‡ Ø²Ù…Ø§Ù†ÛŒ:\n";
          data.time_similarity_suspects.forEach(item => {
            output += `Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² ${item.student1} Ùˆ ${item.student2} Ø¯Ø± ${item.question_id} Ø¨Ø§ Ø§Ø®ØªÙ„Ø§Ù ${item.time_difference} Ø«Ø§Ù†ÛŒÙ‡\n`;
          });
        }

        document.getElementById('result').innerText = output;

      } catch (err) {
        console.error("âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„:", err);
        document.getElementById('result').innerText = 'âŒ Ø®Ø·Ø§ Ø¯Ø± ØªØ­Ù„ÛŒÙ„ ØªÙ‚Ù„Ø¨';
      }
    }
  </script>
</body>
</html>
